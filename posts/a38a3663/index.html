<!doctype html><html><title>pppoe Server安装</title><meta name=description content="环境：ubuntu 16.04
"><meta name=generator content="Hugo 0.84.4"><meta property="og:title" content="pppoe Server安装"><meta property="og:description" content="环境：ubuntu 16.04"><meta property="og:type" content="article"><meta property="og:url" content="https://arair.net/posts/a38a3663/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-02-07T20:24:04+08:00"><meta property="article:modified_time" content="2021-02-25T19:35:42+08:00"><meta itemprop=name content="pppoe Server安装"><meta itemprop=description content="环境：ubuntu 16.04"><meta itemprop=datePublished content="2021-02-07T20:24:04+08:00"><meta itemprop=dateModified content="2021-02-25T19:35:42+08:00"><meta itemprop=wordCount content="605"><meta itemprop=keywords content="pppoe,"><body><div id=content><body><div id=post class=post><article><header><h1 class=post-title>pppoe Server安装</h1><p><small>2021-02-07, updated 2021-02-25</small></p></header><p>环境：ubuntu 16.04</p><h2 id=安装pppoe-server>安装pppoe-server</h2><p>sudo apt-get install pppoe</p><p>pppoe-server -h 命令查看软件版本</p><h2 id=配置服务器>配置服务器</h2><p>在 /etc/ppp 目录下编辑文件：</p><ol><li><p>options</p><p>找到 # ms-dns 去掉注释，改为实际可用的 DNS 服务器地址，如 114.114.114.114，或8.8.8.8 等通用 DNS；</p><p>注释+pap，取消注释-pap;</p><p>取消注释+chap，注释-chap.</p><p><strong>PAP 和 CHAP 为两种不同的认证协议。</strong></p></li><li><p>chap-secrets</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>test * 123456 *
</code></pre></td></tr></table></div></div><p>表示用户名为test，服务器名为任意，密码为123456，IP为任意的IP</p></li><li><p>pppoe-server-options</p><p>此文件不存在话就创建，添加以下内容：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>auth  
require-chap     
logfile /var/log/pppd.log 
</code></pre></td></tr></table></div></div></li></ol><h2 id=设置ip策略>设置IP策略</h2><ol><li><p>开启IP转发功能</p><p>打开 <strong><code>/etc/sysctl.conf</code></strong> 文件，找到 <strong><code>net.ipv4.ip_forward=1</code></strong> 所在行，取消该行的注释，随后运行 <strong><code>sudo sysctl -p</code></strong> 即可打开 IP 转发功能。</p></li><li><p>配置iptables的IP策略</p><p>该步骤需要在超级用户权限下进行:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>iptables -A POSTROUTING -t nat -s 10.211.55.0/24 -j MASQUERADE
</code></pre></td></tr></table></div></div><p>其中 10.211.55.0/24 为实际的网络地址，需要根据自己的实际情况填写。ubuntu上的eth0的地址是11开头的，比如11.1.9.90，那么这里可以设置为11.1.9.88/24</p></li><li><p>或者可以使用这一个替代2</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</code></pre></td></tr></table></div></div><p>eth0：可以上网的网卡</p></li></ol><h2 id=运行-pppoe-服务器>运行 PPPoE 服务器</h2><p>sudo pppoe-server -I eth0 -L 11.1.9.90 -R 11.1.9.100 -N 10</p><p>其中：</p><ul><li>-I 参数为网络端口名称，可以使用 ifconfig 命令查看当前工作的端口。</li><li>-L 参数为一个PPP连接中，PPPoE服务器的IP地址，即当前 Ubuntu 服务器的地址。</li><li>－R 参数为当有客户连接到服务器上时，从哪个IP地址开始分配。</li><li>－N 参数为至多可以有多少个客户同时连接到当前服务器上。</li></ul><p>注：每次重启后需要重新运行此命令，或将此命令设为开机脚本。</p></article></div></body><div><small>words: 605 tags:</small>
<small><code><a href=https://arair.net/tags/pppoe>pppoe</a></code></small></div></html></div><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?bd28dafb59c7621d0ab721cefd01691b",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><script id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script><script>LA.init({id:"JMTlKgP6j8mqnJSa",ck:"JMTlKgP6j8mqnJSa"})</script></body></html>