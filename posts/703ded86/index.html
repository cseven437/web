<!doctype html><html><title>Padavan路由器安装timeMachine</title><meta name=description content="准备工作 刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root
"><meta name=lastmod content="2021-02-07 20:28:34 +0800 +0800 "><body><div id=content><body><div id=post class=post><article><header><h1 class=post-title>Padavan路由器安装timeMachine</h1><p><small>2021-02-07</small></p></header><h1 id=准备工作>准备工作</h1><p>刷了padavan软件的路由器一台</p><p>移动硬盘或u盘</p><p>移动硬盘格式化为ext4文件格式</p><p>挂载移动硬盘到路由器</p><p>安装opkg命令和其它设置</p><p>​ ssh进入后台执行<code>opkg.sh</code>命令，等待执行完成</p><p>​ 修改用户名admin为root</p><h1 id=开始安装>开始安装</h1><ol><li><p>ssh进入路由器</p><p><code>ssh root@192.168.123.1</code></p></li><li><p>安装和配置avahi，执行<code>opkg install avahi-daemon avahi-utils</code></p><ol><li><p>创建一个<code>/opt/etc/avahi/services/afpd.service</code>文件</p></li><li><p>编辑afpd.service文件，把以下内容贴近去</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; standalone=&#39;no&#39;?&gt;</span>
<span style=color:#75715e>&lt;!DOCTYPE service-group SYSTEM &#34;avahi-service.dtd&#34;&gt;</span>
<span style=color:#f92672>&lt;service-group&gt;</span>
    <span style=color:#f92672>&lt;name</span> <span style=color:#a6e22e>replace-wildcards=</span><span style=color:#e6db74>&#34;yes&#34;</span><span style=color:#f92672>&gt;</span>AFP on %h<span style=color:#f92672>&lt;/name&gt;</span>
    <span style=color:#f92672>&lt;service&gt;</span>
        <span style=color:#f92672>&lt;type&gt;</span>_afpovertcp._tcp<span style=color:#f92672>&lt;/type&gt;</span>
        <span style=color:#f92672>&lt;port&gt;</span>548<span style=color:#f92672>&lt;/port&gt;</span>
    <span style=color:#f92672>&lt;/service&gt;</span>
    <span style=color:#f92672>&lt;service&gt;</span>
        <span style=color:#f92672>&lt;type&gt;</span>_device-info._tcp<span style=color:#f92672>&lt;/type&gt;</span>
        <span style=color:#f92672>&lt;port&gt;</span>0<span style=color:#f92672>&lt;/port&gt;</span>
        <span style=color:#f92672>&lt;txt-record&gt;</span>model=TimeMachine<span style=color:#f92672>&lt;/txt-record&gt;</span>
    <span style=color:#f92672>&lt;/service&gt;</span>
<span style=color:#f92672>&lt;/service-group&gt;</span>
</code></pre></td></tr></table></div></div></li><li><p>启动avahi</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/opt/etc/init.d/S20dbus restart
/opt/etc/init.d/S42avahi-daemon restart
</code></pre></td></tr></table></div></div></li><li><p>查看avahi是否运行</p><p><code>ps | grep avahi</code></p></li></ol></li><li><p>安装和配置netatalk，<code>opkg install netatalk</code></p><ol><li><p>编辑配置文件</p><p><code>vi /opt/etc/afp.conf</code></p></li><li><p>把下面的内容贴进去，并按照你的环境修改配置</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>[Global]
afp listen = 192.168.123.1
; 你路由器的 hostname ，执行 hostname 命令查看
hostname = hostname 
;log file = /opt/var/log/afpd.log
;log level = default:info afpdaemon:debug uamsdaemon:info
uam list = uams_guest.so uams_dhx.so uams_dhx2.so
uam path = /opt/lib/uams
mimic model = TimeCapsule6,106
hosts allow = 192.168.123.0/16
guest account = nobody

[TimeMachine]
; timemachine 的路径
path = /media/TIMEMACHINE/
time machine = yes
cnid scheme = dbd
ea = auto
file perm = 0664 directory perm = 0775
</code></pre></td></tr></table></div></div></li><li><p>重启afpd</p><p><code>/opt/etc/init.d/S27afpd restart</code></p></li></ol></li><li><p>在mac电脑上连接</p><ol><li>在Finder里面快捷键<code>command + k</code></li><li>输入<code>afp://192.168.123.1</code>连接</li><li>使用访客连接</li></ol></li></ol><h1 id=问题>问题</h1><p>很不稳定，不建议使用</p><h1 id=参考>参考</h1><p><a href=https://www.ai5suoai.com/xiao-mi-mini-shua-padavan-hou-an-zhuang-time-machine/>小米 mini 刷 padavan 后安装 time machine</a></p></article></div></body><div><small>words: 516 tags:</small>
<small><code><a href=https://arair.net/tags/linux>linux</a></code></small>
<small><code><a href=https://arair.net/tags/padavan>padavan</a></code></small>
<small><code><a href=https://arair.net/tags/route>route</a></code></small>
<small><code><a href=https://arair.net/tags/timemachine>timemachine</a></code></small></div></html></div><script>var _hmt=_hmt||[];(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement("script"),a.src="https://hm.baidu.com/hm.js?bd28dafb59c7621d0ab721cefd01691b",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script></body></html>