<!doctype html><html><title>Padavan路由器安装timeMachine</title><meta name=description content="准备工作 刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root
"><meta name=generator content="Hugo 0.88.1">
<meta property="og:title" content="Padavan路由器安装timeMachine">
<meta property="og:description" content="准备工作
刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root">
<meta property="og:type" content="article">
<meta property="og:url" content="https://arair.net/posts/703ded86/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-02-07T20:28:34+08:00">
<meta property="article:modified_time" content="2021-02-07T20:28:34+08:00">
<meta itemprop=name content="Padavan路由器安装timeMachine">
<meta itemprop=description content="准备工作
刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root"><meta itemprop=datePublished content="2021-02-07T20:28:34+08:00">
<meta itemprop=dateModified content="2021-02-07T20:28:34+08:00">
<meta itemprop=wordCount content="481">
<meta itemprop=keywords content="linux,padavan,route,timemachine,">
<style type=text/css>.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}@media(max-width:767px){.markdown-body{padding:15px}}</style>
<script>function setTheme({el:a=document.documentElement,mode:b='auto',light:c='light',dark:d='dark'}){a.dataset.colorMode=b,a.dataset.lightTheme=c,a.dataset.darkTheme=d}let prefersDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches;prefersDarkMode&&setTheme({mode:'dark'})</script>
<link rel=stylesheet href=/style.css type=text/css><body id=content class=markdown-body>
<body>
<div id=post class=post>
<article>
<header>
<h1 class=post-title>Padavan路由器安装timeMachine</h1>
<p>
<small>
2021-02-07
</small>
</p>
</header>
<aside>
<nav id=TableOfContents></nav>
</aside>
<h1 id=准备工作>准备工作</h1>
<p>刷了padavan软件的路由器一台</p>
<p>移动硬盘或u盘</p>
<p>移动硬盘格式化为ext4文件格式</p>
<p>挂载移动硬盘到路由器</p>
<p>安装opkg命令和其它设置</p>
<p>​ ssh进入后台执行<code>opkg.sh</code>命令，等待执行完成</p>
<p>​ 修改用户名admin为root</p>
<h1 id=开始安装>开始安装</h1>
<ol>
<li>
<p>ssh进入路由器</p>
<p><code>ssh root@192.168.123.1</code></p>
</li>
<li>
<p>安装和配置avahi，执行<code>opkg install avahi-daemon avahi-utils</code></p>
<ol>
<li>
<p>创建一个<code>/opt/etc/avahi/services/afpd.service</code>文件</p>
</li>
<li>
<p>编辑afpd.service文件，把以下内容贴近去</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=cp>&lt;?xml version=&#34;1.0&#34; standalone=&#39;no&#39;?&gt;</span>
<span class=cp>&lt;!DOCTYPE service-group SYSTEM &#34;avahi-service.dtd&#34;&gt;</span>
<span class=nt>&lt;service-group&gt;</span>
    <span class=nt>&lt;name</span> <span class=na>replace-wildcards=</span><span class=s>&#34;yes&#34;</span><span class=nt>&gt;</span>AFP on %h<span class=nt>&lt;/name&gt;</span>
    <span class=nt>&lt;service&gt;</span>
        <span class=nt>&lt;type&gt;</span>_afpovertcp._tcp<span class=nt>&lt;/type&gt;</span>
        <span class=nt>&lt;port&gt;</span>548<span class=nt>&lt;/port&gt;</span>
    <span class=nt>&lt;/service&gt;</span>
    <span class=nt>&lt;service&gt;</span>
        <span class=nt>&lt;type&gt;</span>_device-info._tcp<span class=nt>&lt;/type&gt;</span>
        <span class=nt>&lt;port&gt;</span>0<span class=nt>&lt;/port&gt;</span>
        <span class=nt>&lt;txt-record&gt;</span>model=TimeMachine<span class=nt>&lt;/txt-record&gt;</span>
    <span class=nt>&lt;/service&gt;</span>
<span class=nt>&lt;/service-group&gt;</span>
</code></pre></div></li>
<li>
<p>启动avahi</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash>/opt/etc/init.d/S20dbus restart
/opt/etc/init.d/S42avahi-daemon restart
</code></pre></div></li>
<li>
<p>查看avahi是否运行</p>
<p><code>ps | grep avahi</code></p>
</li>
</ol>
</li>
<li>
<p>安装和配置netatalk，<code>opkg install netatalk</code></p>
<ol>
<li>
<p>编辑配置文件</p>
<p><code>vi /opt/etc/afp.conf</code></p>
</li>
<li>
<p>把下面的内容贴进去，并按照你的环境修改配置</p>
<pre tabindex=0><code>[Global]
afp listen = 192.168.123.1
; 你路由器的 hostname ，执行 hostname 命令查看
hostname = hostname 
;log file = /opt/var/log/afpd.log
;log level = default:info afpdaemon:debug uamsdaemon:info
uam list = uams_guest.so uams_dhx.so uams_dhx2.so
uam path = /opt/lib/uams
mimic model = TimeCapsule6,106
hosts allow = 192.168.123.0/16
guest account = nobody

[TimeMachine]
; timemachine 的路径
path = /media/TIMEMACHINE/
time machine = yes
cnid scheme = dbd
ea = auto
file perm = 0664 directory perm = 0775
</code></pre></li>
<li>
<p>重启afpd</p>
<p><code>/opt/etc/init.d/S27afpd restart</code></p>
</li>
</ol>
</li>
<li>
<p>在mac电脑上连接</p>
<ol>
<li>在Finder里面快捷键<code>command + k</code></li>
<li>输入<code>afp://192.168.123.1</code>连接</li>
<li>使用访客连接</li>
</ol>
</li>
</ol>
<h1 id=问题>问题</h1>
<p>很不稳定，不建议使用</p>
<h1 id=参考>参考</h1>
<p><a href=https://www.ai5suoai.com/xiao-mi-mini-shua-padavan-hou-an-zhuang-time-machine/>小米 mini 刷 padavan 后安装 time machine</a></p>
</article>
</div>
</body>
<div>
<small> words: 481 tags:</small>
<small><code><a href=https://arair.net/tags/linux>linux</a></code></small>
<small><code><a href=https://arair.net/tags/padavan>padavan</a></code></small>
<small><code><a href=https://arair.net/tags/route>route</a></code></small>
<small><code><a href=https://arair.net/tags/timemachine>timemachine</a></code></small>
</div>
</html>
</body>
<script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?bd28dafb59c7621d0ab721cefd01691b",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script>
<script id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script>
<script>LA.init({id:"JMTlKgP6j8mqnJSa",ck:"JMTlKgP6j8mqnJSa"})</script>
<link rel=stylesheet href=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/styles/default.min.css>
<script src=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.2.0/build/highlight.min.js></script>
<script>hljs.highlightAll()</script>
<script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>window.onload=function(){mermaid.initialize({theme:"default"}),mermaid.init(void 0,".language-mermaid")}</script></html>