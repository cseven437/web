<!doctype html><html><title>Padavan路由器安装timeMachine</title><meta name=description content="准备工作 刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root
"><meta name=generator content="Hugo 0.101.0"><meta property="og:title" content="Padavan路由器安装timeMachine"><meta property="og:description" content="准备工作
刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root"><meta property="og:type" content="article"><meta property="og:url" content="https://arair.net/p/other/703ded86/"><meta property="article:section" content="p"><meta property="article:published_time" content="2021-02-07T20:28:34+08:00"><meta property="article:modified_time" content="2021-02-07T20:28:34+08:00"><meta itemprop=name content="Padavan路由器安装timeMachine"><meta itemprop=description content="准备工作
刷了padavan软件的路由器一台
移动硬盘或u盘
移动硬盘格式化为ext4文件格式
挂载移动硬盘到路由器
安装opkg命令和其它设置
​	ssh进入后台执行opkg.sh命令，等待执行完成
​	修改用户名admin为root"><meta itemprop=datePublished content="2021-02-07T20:28:34+08:00"><meta itemprop=dateModified content="2021-02-07T20:28:34+08:00"><meta itemprop=wordCount content="516"><meta itemprop=keywords content="linux,padavan,route,timemachine,"><style type=text/css>.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px;font-family:Consolas,courier new,monospace}@media(max-width:767px){.markdown-body{padding:15px}}</style><script>function setTheme({el:e=document.documentElement,mode:t="auto",light:n="light",dark:s="dark"}){e.dataset.colorMode=t,e.dataset.lightTheme=n,e.dataset.darkTheme=s}let prefersDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches;prefersDarkMode&&setTheme({mode:"dark"})</script><body id=content class=markdown-body><body><div id=post class=post><article><header><h1 class=post-title>Padavan路由器安装timeMachine</h1><p><small>2021-02-07</small></p></header><aside><nav id=TableOfContents></nav></aside><h1 id=准备工作>准备工作</h1><p>刷了padavan软件的路由器一台</p><p>移动硬盘或u盘</p><p>移动硬盘格式化为ext4文件格式</p><p>挂载移动硬盘到路由器</p><p>安装opkg命令和其它设置</p><p>​ ssh进入后台执行<code>opkg.sh</code>命令，等待执行完成</p><p>​ 修改用户名admin为root</p><h1 id=开始安装>开始安装</h1><ol><li><p>ssh进入路由器</p><p><code>ssh root@192.168.123.1</code></p></li><li><p>安装和配置avahi，执行<code>opkg install avahi-daemon avahi-utils</code></p><ol><li><p>创建一个<code>/opt/etc/avahi/services/afpd.service</code>文件</p></li><li><p>编辑afpd.service文件，把以下内容贴近去</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff79c6>&lt;?xml version=&#34;1.0&#34; standalone=&#39;no&#39;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;!DOCTYPE service-group SYSTEM &#34;avahi-service.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;service-group&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;name</span> <span style=color:#50fa7b>replace-wildcards=</span><span style=color:#f1fa8c>&#34;yes&#34;</span><span style=color:#ff79c6>&gt;</span>AFP on %h<span style=color:#ff79c6>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;service&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;type&gt;</span>_afpovertcp._tcp<span style=color:#ff79c6>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;port&gt;</span>548<span style=color:#ff79c6>&lt;/port&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;/service&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;service&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;type&gt;</span>_device-info._tcp<span style=color:#ff79c6>&lt;/type&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;port&gt;</span>0<span style=color:#ff79c6>&lt;/port&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;txt-record&gt;</span>model=TimeMachine<span style=color:#ff79c6>&lt;/txt-record&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&lt;/service&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&lt;/service-group&gt;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p>启动avahi</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/opt/etc/init.d/S20dbus restart
</span></span><span style=display:flex><span>/opt/etc/init.d/S42avahi-daemon restart
</span></span></code></pre></td></tr></table></div></div></li><li><p>查看avahi是否运行</p><p><code>ps | grep avahi</code></p></li></ol></li><li><p>安装和配置netatalk，<code>opkg install netatalk</code></p><ol><li><p>编辑配置文件</p><p><code>vi /opt/etc/afp.conf</code></p></li><li><p>把下面的内容贴进去，并按照你的环境修改配置</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>[Global]
</span></span><span style=display:flex><span>afp listen = 192.168.123.1
</span></span><span style=display:flex><span>; 你路由器的 hostname ，执行 hostname 命令查看
</span></span><span style=display:flex><span>hostname = hostname 
</span></span><span style=display:flex><span>;log file = /opt/var/log/afpd.log
</span></span><span style=display:flex><span>;log level = default:info afpdaemon:debug uamsdaemon:info
</span></span><span style=display:flex><span>uam list = uams_guest.so uams_dhx.so uams_dhx2.so
</span></span><span style=display:flex><span>uam path = /opt/lib/uams
</span></span><span style=display:flex><span>mimic model = TimeCapsule6,106
</span></span><span style=display:flex><span>hosts allow = 192.168.123.0/16
</span></span><span style=display:flex><span>guest account = nobody
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[TimeMachine]
</span></span><span style=display:flex><span>; timemachine 的路径
</span></span><span style=display:flex><span>path = /media/TIMEMACHINE/
</span></span><span style=display:flex><span>time machine = yes
</span></span><span style=display:flex><span>cnid scheme = dbd
</span></span><span style=display:flex><span>ea = auto
</span></span><span style=display:flex><span>file perm = 0664 directory perm = 0775
</span></span></code></pre></td></tr></table></div></div></li><li><p>重启afpd</p><p><code>/opt/etc/init.d/S27afpd restart</code></p></li></ol></li><li><p>在mac电脑上连接</p><ol><li>在Finder里面快捷键<code>command + k</code></li><li>输入<code>afp://192.168.123.1</code>连接</li><li>使用访客连接</li></ol></li></ol><h1 id=问题>问题</h1><p>很不稳定，不建议使用</p><h1 id=参考>参考</h1><p><a href=https://www.ai5suoai.com/xiao-mi-mini-shua-padavan-hou-an-zhuang-time-machine/>小米 mini 刷 padavan 后安装 time machine</a></p></article></div></body><div><small>words: 516 tags:</small>
<small><code><a href=https://arair.net/tags/linux>linux</a></code></small>
<small><code><a href=https://arair.net/tags/padavan>padavan</a></code></small>
<small><code><a href=https://arair.net/tags/route>route</a></code></small>
<small><code><a href=https://arair.net/tags/timemachine>timemachine</a></code></small></div></html></body><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?bd28dafb59c7621d0ab721cefd01691b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script>
<script>LA.init({id:"JMTlKgP6j8mqnJSa",ck:"JMTlKgP6j8mqnJSa"})</script></html>