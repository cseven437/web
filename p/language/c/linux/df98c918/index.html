<!doctype html><html><title>linux进程间通信--套接字 tcp</title><meta name=description content="linux下tcp函数实现示例
包含ipv4与ipv6
"><meta name=generator content="Hugo 0.101.0"><meta property="og:title" content="linux进程间通信--套接字 tcp"><meta property="og:description" content="linux下tcp函数实现示例
包含ipv4与ipv6"><meta property="og:type" content="article"><meta property="og:url" content="https://arair.net/p/language/c/linux/df98c918/"><meta property="article:section" content="p"><meta property="article:published_time" content="2021-02-04T10:00:53+08:00"><meta property="article:modified_time" content="2021-02-04T10:00:53+08:00"><meta itemprop=name content="linux进程间通信--套接字 tcp"><meta itemprop=description content="linux下tcp函数实现示例
包含ipv4与ipv6"><meta itemprop=datePublished content="2021-02-04T10:00:53+08:00"><meta itemprop=dateModified content="2021-02-04T10:00:53+08:00"><meta itemprop=wordCount content="4102"><meta itemprop=keywords content="linux,tcp,c,"><style type=text/css>.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px;font-family:Consolas,courier new,monospace}@media(max-width:767px){.markdown-body{padding:15px}}</style><script>function setTheme({el:e=document.documentElement,mode:t="auto",light:n="light",dark:s="dark"}){e.dataset.colorMode=t,e.dataset.lightTheme=n,e.dataset.darkTheme=s}let prefersDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches;prefersDarkMode&&setTheme({mode:"dark"})</script><body id=content class=markdown-body><body><div id=post class=post><article><header><h1 class=post-title>linux进程间通信--套接字 tcp</h1><p><small>2021-02-04</small></p></header><aside><nav id=TableOfContents><ul><li><a href=#双栈单独版本>双栈单独版本</a><ul><li><a href=#server>server</a></li><li><a href=#client>client</a></li></ul></li><li><a href=#ipv4与ipv6优化版本>ipv4与ipv6优化版本</a><ul><li><a href=#server-1>server</a></li><li><a href=#client-1>client</a></li></ul></li></ul></nav></aside><p>linux下tcp函数实现示例</p><p>包含ipv4与ipv6</p><h2 id=双栈单独版本>双栈单独版本</h2><h3 id=server>server</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/socket.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netinet/in.h&gt; //互联网地址族</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;arpa/inet.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netdb.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;unistd.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;time.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;ctype.h&gt; //toupper （小写转化为大写）</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> port <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>8000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/*服务端*/</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>argv)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#ifdef TCP_IPV6
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#ff79c6>struct</span> sockaddr_in6 sin;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> sockaddr_in6 pin;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#ff79c6>struct</span> sockaddr_in6 sin; <span style=color:#6272a4>//struct sockaddr和struct sockaddr_in这两个结构体用来处理网络通信的地址。
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>struct</span> sockaddr_in6 pin;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#8be9fd>int</span> sock_descriptor; <span style=color:#6272a4>//  套接口描述字
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>int</span> temp_sock_descriptor;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> address_size;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>16384</span>]; <span style=color:#6272a4>// 缓冲区大小
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> i, len;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     *int socket(int domain, int type, int protocol);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * PF_INET, AF_INET： Ipv4网络协议
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * PF_INET6, AF_INET6： Ipv6网络协议。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * type参数的作用是设置通信的协议类型，可能的取值如下所示：
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　      SOCK_STREAM： 提供面向连接的稳定数据传输，即TCP协议。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　      OOB： 在所有数据传送前必须使用connect()来建立连接状态。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　      　SOCK_DGRAM： 使用不连续不可靠的数据包连接。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　      SOCK_SEQPACKET： 提供连续可靠的数据包连接。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　      　SOCK_RAW： 提供原始网络协议存取。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　      　SOCK_RDM： 提供可靠的数据包连接。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　      SOCK_PACKET： 与网络驱动程序直接通信。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//socket函数，向系统申请一个通信端口
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>#ifdef TCP_IPV6
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    sock_descriptor <span style=color:#ff79c6>=</span> socket(AF_INET6, SOCK_STREAM, <span style=color:#bd93f9>0</span>); 
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    sock_descriptor <span style=color:#ff79c6>=</span> socket(AF_INET, SOCK_STREAM, <span style=color:#bd93f9>0</span>); <span style=color:#6272a4>//IPV4 TCP协议
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#ff79c6>if</span> (sock_descriptor <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)                         <span style=color:#6272a4>//申请失败
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to socket&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    bzero(<span style=color:#ff79c6>&amp;</span>sin, <span style=color:#ff79c6>sizeof</span>(sin));         <span style=color:#6272a4>// 初始化 然后是设置套接字
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>#ifdef TCP_IPV6
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    sin.sin6_family <span style=color:#ff79c6>=</span> AF_INET6;
</span></span><span style=display:flex><span>    sin.sin6_addr <span style=color:#ff79c6>=</span> (<span style=color:#ff79c6>struct</span> in6_addr)IN6ADDR_ANY_INIT;
</span></span><span style=display:flex><span>    sin.sin6_port <span style=color:#ff79c6>=</span> htons(port);
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    sin.sin_family <span style=color:#ff79c6>=</span> AF_INET;         <span style=color:#6272a4>//协议族，在socket编程中只能是AF_INET(TCP/IP协议族)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sin.sin_addr.s_addr <span style=color:#ff79c6>=</span> INADDR_ANY; <span style=color:#6272a4>//sin_addr存储IP地址,使用in_addr这个数据结构
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>                                      <span style=color:#6272a4>//s_addr按照网络字节顺序存储IP地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>                                      <span style=color:#6272a4>//in_addr32位的IPv4地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sin.sin_port <span style=color:#ff79c6>=</span> htons(port);       <span style=color:#6272a4>//存储端口号
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#6272a4>//将套接字（sin） 跟端口（sock_descriptor）链接
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (bind(sock_descriptor, (<span style=color:#ff79c6>struct</span> sockaddr <span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>sin, <span style=color:#ff79c6>sizeof</span>(sin)) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to bind&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*int PASCAL FAR listen( SOCKET s, int backlog);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　     S：用于标识一个已捆绑未连接套接口的描述字。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　     backlog：等待连接队列的最大长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * listen()仅适用于支持连接的套接口，如SOCK_STREAM类型的。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (listen(sock_descriptor, <span style=color:#bd93f9>20</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#6272a4>//在端口sock_descriptor监听
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to listen&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;accepting connections </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (<span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    { <span style=color:#6272a4>//用来监听的端口sock_descriptor
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        temp_sock_descriptor <span style=color:#ff79c6>=</span> accept(sock_descriptor, (<span style=color:#ff79c6>struct</span> sockaddr <span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>pin, <span style=color:#ff79c6>&amp;</span>address_size);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (temp_sock_descriptor <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            perror(<span style=color:#f1fa8c>&#34;call to accept&#34;</span>);
</span></span><span style=display:flex><span>            exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>/*int PASCAL FAR recv( SOCKET s, char FAR* buf, int len, int flags);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        s：一个标识已连接套接口的描述字。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        buf：用于接收数据的缓冲区。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        len：缓冲区长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        flags：指定调用方式。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>         */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;wait to recv message</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>struct</span> timeval tv;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Set up the struct timeval for the timeout.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        tv.tv_sec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>30</span>;
</span></span><span style=display:flex><span>        tv.tv_usec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// 添加socket延时
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// setsockopt(temp_sock_descriptor, SOL_SOCKET, SO_RCVTIMEO, (char *)&amp;tv, sizeof(struct timeval));
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (recv(temp_sock_descriptor, buf, <span style=color:#bd93f9>16384</span>, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            perror(<span style=color:#f1fa8c>&#34;call to recv&#34;</span>);
</span></span><span style=display:flex><span>            exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;received from client:%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, buf);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        len <span style=color:#ff79c6>=</span> strlen(buf);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> len; i<span style=color:#ff79c6>++</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            buf[i] <span style=color:#ff79c6>=</span> toupper(buf[i]); <span style=color:#6272a4>//将小写字母转化为大写字母
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        }
</span></span><span style=display:flex><span>        <span style=color:#6272a4>/*int PASCAL FAR send( SOCKET s, const char FAR* buf, int len, int flags);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        s：一个用于标识已连接套接口的描述字。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        buf：包含待发送数据的缓冲区。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        len：缓冲区中数据的长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        flags：调用执行方式。*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>/*send()   基于链接的发送 TCP
</span></span></span><span style=display:flex><span><span style=color:#6272a4>         *sendto() 基于无链接到   UDP
</span></span></span><span style=display:flex><span><span style=color:#6272a4>         */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (send(temp_sock_descriptor, buf, len, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            perror(<span style=color:#f1fa8c>&#34;call to send&#34;</span>);
</span></span><span style=display:flex><span>            exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        close(temp_sock_descriptor);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> (EXIT_SUCCESS);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=client>client</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/select.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netinet/in.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;arpa/inet.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netdb.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#6272a4>/*客户端*/</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#ifdef TCP_IPV6
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>host_name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;::1&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>host_name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;127.0.0.1&#34;</span>; <span style=color:#6272a4>//需要搜寻服务端IP地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#8be9fd>int</span> port <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>8000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/*argc: 整数,用来统计你运行程序时送给main函数的命令行参数的个数
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * argv: 字符串数组，用来存放指向你的字符串参数的指针数组，每一个元素指向一个参数
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　argv[0] 指向程序运行的全路径名
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　argv[1] 指向在DOS命令行中执行程序名后的第一个字符串
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　argv[2] 指向执行程序名后的第二个字符串
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>argv)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>8192</span>];
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> message[<span style=color:#bd93f9>256</span>];
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> socket_descriptor;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#ifdef TCP_IPV6
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#ff79c6>struct</span> sockaddr_in6 pin;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#ff79c6>struct</span> sockaddr_in pin; <span style=color:#6272a4>//处理网络通信的地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * hostent记录主机的信息，包括主机名、别名、地址类型、地址长度和地址列表
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * struct hostent {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　       char *h_name;地址的正式名称
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　       char **h_aliases;空字节-地址的预备名称的指针
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　       int h_addrtype;地址类型; 通常是AF_INET。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　       　int h_length;地址的比特长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　       　char **h_addr_list;零字节-主机网络地址指针。网络字节顺序。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　    };
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　   #define h_addr h_addr_list[0] //h_addr_list中的第一地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> hostent <span style=color:#ff79c6>*</span>server_host_name;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>str <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;A default test string&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (argc <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>2</span>) <span style=color:#6272a4>//运行程序时送给main函数到命令行参数个数
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;Usage:test </span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>Any test string</span><span style=color:#f1fa8c>\&#34;\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;we will send a default test string. </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        str <span style=color:#ff79c6>=</span> argv[<span style=color:#bd93f9>1</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * gethostbyname()返回对应于给定主机名的包含主机名字和地址信息的
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * hostent结构指针。结构的声明与gethostaddr()中一致。*/</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ((server_host_name <span style=color:#ff79c6>=</span> gethostbyname(host_name)) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error resolving local host </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    bzero(<span style=color:#ff79c6>&amp;</span>pin, <span style=color:#ff79c6>sizeof</span>(pin));
</span></span><span style=display:flex><span><span style=color:#ff79c6>#ifdef TCP_IPV6
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    pin.sin6_family <span style=color:#ff79c6>=</span> AF_INET6;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (inet_pton(AF_INET6, host_name, <span style=color:#ff79c6>&amp;</span>pin.sin6_addr) <span style=color:#ff79c6>&lt;=</span> <span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;pton&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>2</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    pin.sin6_port <span style=color:#ff79c6>=</span> htons(port);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ((socket_descriptor <span style=color:#ff79c6>=</span> socket(AF_INET6, SOCK_STREAM, <span style=color:#bd93f9>0</span>)) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error opening socket </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    pin.sin_family <span style=color:#ff79c6>=</span> AF_INET;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//htonl()将主机的无符号长整形数转换成网络字节顺序
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    pin.sin_addr.s_addr <span style=color:#ff79c6>=</span> htonl(INADDR_ANY);                                      <span style=color:#6272a4>//s_addr按照网络字节顺序存储IP地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>                                                                                  <span style=color:#6272a4>//in_addr 32位的IPv4地址  h_addr_list中的第一地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    pin.sin_addr.s_addr <span style=color:#ff79c6>=</span> ((<span style=color:#ff79c6>struct</span> in_addr <span style=color:#ff79c6>*</span>)(server_host_name<span style=color:#ff79c6>-&gt;</span>h_addr))<span style=color:#ff79c6>-&gt;</span>s_addr; <span style=color:#6272a4>// 跟书上不一样 必须是h_addr
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>    pin.sin_port <span style=color:#ff79c6>=</span> htons(port);
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*申请一个通信端口*/</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> ((socket_descriptor <span style=color:#ff79c6>=</span> socket(AF_INET, SOCK_STREAM, <span style=color:#bd93f9>0</span>)) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error opening socket </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>    <span style=color:#6272a4>//pin 定义跟服务端连接的 IP 端口
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (connect(socket_descriptor, (<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>pin, <span style=color:#ff79c6>sizeof</span>(pin)) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error connecting to socket </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>); <span style=color:#6272a4>////
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;Sending message %s to server </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, str);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> num1 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span>(num1<span style=color:#ff79c6>++</span> <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>60</span>) {
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;num1:%d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, num1);
</span></span><span style=display:flex><span>        sleep(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (send(socket_descriptor, str, strlen(str), <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error in send</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;..sent message.. wait for response...</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (recv(socket_descriptor, buf, <span style=color:#bd93f9>8192</span>, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error in receiving response from server </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c> Response from server:</span><span style=color:#f1fa8c>\n\n</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, buf);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    close(socket_descriptor);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> (EXIT_SUCCESS);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=ipv4与ipv6优化版本>ipv4与ipv6优化版本</h2><p>根据argv[1]输入的地址是ipv4 还是ipv6自行判断使用哪一个</p><h3 id=server-1>server</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/socket.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netinet/in.h&gt; //互联网地址族</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;arpa/inet.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netdb.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;unistd.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;time.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;ctype.h&gt; //toupper （小写转化为大写）</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// int port = 8000;
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// char *server = &#34;localhost&#34;;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>server <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;127.0.0.1&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>PrintSocketAddress</span>(<span style=color:#ff79c6>const</span> <span style=color:#ff79c6>struct</span> sockaddr <span style=color:#ff79c6>*</span>address, FILE <span style=color:#ff79c6>*</span>stream) {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Test for address and stream
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (address <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span> <span style=color:#ff79c6>||</span> stream <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>numericAddress; <span style=color:#6272a4>// Pointer to binary address
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Buffer to contain result (IPv6 sufficient to hold IPv4)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#8be9fd>char</span> addrBuffer[INET6_ADDRSTRLEN];
</span></span><span style=display:flex><span>    in_port_t port; <span style=color:#6272a4>// Port to print
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>// Set pointer to address based on address family
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>switch</span> (address<span style=color:#ff79c6>-&gt;</span>sa_family) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>AF_INET</span>:
</span></span><span style=display:flex><span>            numericAddress <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span>((<span style=color:#ff79c6>struct</span> sockaddr_in <span style=color:#ff79c6>*</span>) address)<span style=color:#ff79c6>-&gt;</span>sin_addr;
</span></span><span style=display:flex><span>            port <span style=color:#ff79c6>=</span> ntohs(((<span style=color:#ff79c6>struct</span> sockaddr_in <span style=color:#ff79c6>*</span>) address)<span style=color:#ff79c6>-&gt;</span>sin_port);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>AF_INET6</span>:
</span></span><span style=display:flex><span>            numericAddress <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span>((<span style=color:#ff79c6>struct</span> sockaddr_in6 <span style=color:#ff79c6>*</span>) address)<span style=color:#ff79c6>-&gt;</span>sin6_addr;
</span></span><span style=display:flex><span>            port <span style=color:#ff79c6>=</span> ntohs(((<span style=color:#ff79c6>struct</span> sockaddr_in6 <span style=color:#ff79c6>*</span>) address)<span style=color:#ff79c6>-&gt;</span>sin6_port);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>default</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>            fputs(<span style=color:#f1fa8c>&#34;[unknown type]&#34;</span>, stream);    <span style=color:#6272a4>// Unhandled type
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>            <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// Convert binary to printable address
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (inet_ntop(address<span style=color:#ff79c6>-&gt;</span>sa_family, numericAddress, addrBuffer,
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>sizeof</span>(addrBuffer)) <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span>)
</span></span><span style=display:flex><span>        fputs(<span style=color:#f1fa8c>&#34;[invalid address]&#34;</span>, stream); <span style=color:#6272a4>// Unable to convert
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>        fprintf(stream, <span style=color:#f1fa8c>&#34;%s&#34;</span>, addrBuffer);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (port <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>)                <span style=color:#6272a4>// Zero not valid in any socket addr
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>            fprintf(stream, <span style=color:#f1fa8c>&#34;-%u&#34;</span>, port);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>create_socket</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>servername, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>port)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> sockfd <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> address_size;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> addrinfo hints;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> addrinfo <span style=color:#ff79c6>*</span>result;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> i, len;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    memset(<span style=color:#ff79c6>&amp;</span>hints, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>sizeof</span>(hints));
</span></span><span style=display:flex><span>    hints.ai_family <span style=color:#ff79c6>=</span> AF_UNSPEC;    <span style=color:#6272a4>/* Allow IPv4 or IPv6 */</span>
</span></span><span style=display:flex><span>    hints.ai_socktype <span style=color:#ff79c6>=</span> SOCK_STREAM; <span style=color:#6272a4>/* Datagram socket */</span>
</span></span><span style=display:flex><span>    hints.ai_flags <span style=color:#ff79c6>=</span> AI_PASSIVE;    <span style=color:#6272a4>/* For wildcard IP address */</span>
</span></span><span style=display:flex><span>    hints.ai_protocol <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;          <span style=color:#6272a4>/* Any protocol */</span>
</span></span><span style=display:flex><span>    hints.ai_canonname <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>    hints.ai_addr <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>    hints.ai_next <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> s <span style=color:#ff79c6>=</span> getaddrinfo(servername, port, <span style=color:#ff79c6>&amp;</span>hints, <span style=color:#ff79c6>&amp;</span>result);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (s <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>        fprintf(stderr, <span style=color:#f1fa8c>&#34;getaddrinfo: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, gai_strerror(s));
</span></span><span style=display:flex><span>        exit(EXIT_FAILURE);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//socket函数，向系统申请一个通信端口
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sockfd <span style=color:#ff79c6>=</span> socket(result<span style=color:#ff79c6>-&gt;</span>ai_family, result<span style=color:#ff79c6>-&gt;</span>ai_socktype, <span style=color:#bd93f9>0</span>); <span style=color:#6272a4>//IPV4 TCP协议
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (sockfd <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)                         <span style=color:#6272a4>//申请失败
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to socket&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//将套接字（sin） 跟端口（sockfd）链接
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (bind(sockfd, result<span style=color:#ff79c6>-&gt;</span>ai_addr, result<span style=color:#ff79c6>-&gt;</span>ai_addrlen) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to bind&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> sockaddr_storage local_addr;
</span></span><span style=display:flex><span>    socklen_t addr_size<span style=color:#ff79c6>=</span><span style=color:#ff79c6>sizeof</span>(local_addr);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span>(getsockname(sockfd,(<span style=color:#ff79c6>struct</span> sockaddr <span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>local_addr,<span style=color:#ff79c6>&amp;</span>addr_size)<span style=color:#ff79c6>&lt;</span><span style=color:#bd93f9>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// DieWithSystemMessage(&#34;getsockname() failed!&#34;);
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }
</span></span><span style=display:flex><span>    fputs(<span style=color:#f1fa8c>&#34;Binding to &#34;</span>,stdout);
</span></span><span style=display:flex><span>    PrintSocketAddress((<span style=color:#ff79c6>struct</span> sockaddr<span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>local_addr,stdout);
</span></span><span style=display:flex><span>    freeaddrinfo(result);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*int PASCAL FAR listen( SOCKET s, int backlog);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　     S：用于标识一个已捆绑未连接套接口的描述字。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　     backlog：等待连接队列的最大长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * listen()仅适用于支持连接的套接口，如SOCK_STREAM类型的。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (listen(sockfd, <span style=color:#bd93f9>20</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#6272a4>//在端口sockfd监听
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to listen&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;accepting connections </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> sockfd;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/*服务端*/</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>argv)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> sock_descriptor <span style=color:#ff79c6>=</span> create_socket(argv[<span style=color:#bd93f9>1</span>], <span style=color:#f1fa8c>&#34;8000&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> temp_sock_descriptor;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> address_size;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>16384</span>]; <span style=color:#6272a4>// 缓冲区大小
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>struct</span> sockaddr_storage pin;
</span></span><span style=display:flex><span>    address_size <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>sizeof</span>(pin);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> i, len;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (<span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    { <span style=color:#6272a4>//用来监听的端口sock_descriptor
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        temp_sock_descriptor <span style=color:#ff79c6>=</span> accept(sock_descriptor, (<span style=color:#ff79c6>struct</span> sockaddr <span style=color:#ff79c6>*</span>)<span style=color:#ff79c6>&amp;</span>pin, <span style=color:#ff79c6>&amp;</span>address_size);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (temp_sock_descriptor <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            perror(<span style=color:#f1fa8c>&#34;call to accept&#34;</span>);
</span></span><span style=display:flex><span>            exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>/*int PASCAL FAR recv( SOCKET s, char FAR* buf, int len, int flags);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        s：一个标识已连接套接口的描述字。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        buf：用于接收数据的缓冲区。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        len：缓冲区长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        flags：指定调用方式。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>         */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;wait to recv message</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>struct</span> timeval tv;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// Set up the struct timeval for the timeout.
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        tv.tv_sec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>30</span>;
</span></span><span style=display:flex><span>        tv.tv_usec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#6272a4>// 添加socket延时
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#6272a4>// setsockopt(temp_sock_descriptor, SOL_SOCKET, SO_RCVTIMEO, (char *)&amp;tv, sizeof(struct timeval));
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (recv(temp_sock_descriptor, buf, <span style=color:#bd93f9>16384</span>, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            perror(<span style=color:#f1fa8c>&#34;call to recv&#34;</span>);
</span></span><span style=display:flex><span>            exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;received from client:%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, buf);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        len <span style=color:#ff79c6>=</span> strlen(buf);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> len; i<span style=color:#ff79c6>++</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            buf[i] <span style=color:#ff79c6>=</span> toupper(buf[i]); <span style=color:#6272a4>//将小写字母转化为大写字母
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        }
</span></span><span style=display:flex><span>        <span style=color:#6272a4>/*int PASCAL FAR send( SOCKET s, const char FAR* buf, int len, int flags);
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        s：一个用于标识已连接套接口的描述字。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        buf：包含待发送数据的缓冲区。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        len：缓冲区中数据的长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　        flags：调用执行方式。*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#6272a4>/*send()   基于链接的发送 TCP
</span></span></span><span style=display:flex><span><span style=color:#6272a4>         *sendto() 基于无链接到   UDP
</span></span></span><span style=display:flex><span><span style=color:#6272a4>         */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (send(temp_sock_descriptor, buf, len, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            perror(<span style=color:#f1fa8c>&#34;call to send&#34;</span>);
</span></span><span style=display:flex><span>            exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        close(temp_sock_descriptor);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> (EXIT_SUCCESS);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h3 id=client-1>client</h3><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/select.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netinet/in.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;arpa/inet.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;netdb.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#6272a4>/*客户端*/</span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// char *host_name = &#34;fe80::20c:29ff:fe09:2d36&#34;; //需要搜寻服务端IP地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4>// char *host_name = &#34;::1&#34;; //需要搜寻服务端IP地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd>int</span> port <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>8000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>create_sock</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>servername, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>port)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> sockfd;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> addrinfo hints;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> addrinfo <span style=color:#ff79c6>*</span>result;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> i, len;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    memset(<span style=color:#ff79c6>&amp;</span>hints, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>sizeof</span>(hints));
</span></span><span style=display:flex><span>    hints.ai_family <span style=color:#ff79c6>=</span> AF_UNSPEC;    <span style=color:#6272a4>/* Allow IPv4 or IPv6 */</span>
</span></span><span style=display:flex><span>    hints.ai_socktype <span style=color:#ff79c6>=</span> SOCK_STREAM; <span style=color:#6272a4>/* Datagram socket */</span>
</span></span><span style=display:flex><span>    hints.ai_flags <span style=color:#ff79c6>=</span> AI_PASSIVE;    <span style=color:#6272a4>/* For wildcard IP address */</span>
</span></span><span style=display:flex><span>    hints.ai_protocol <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;          <span style=color:#6272a4>/* Any protocol */</span>
</span></span><span style=display:flex><span>    hints.ai_canonname <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>    hints.ai_addr <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>    hints.ai_next <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> s <span style=color:#ff79c6>=</span> getaddrinfo(servername, port, <span style=color:#ff79c6>&amp;</span>hints, <span style=color:#ff79c6>&amp;</span>result);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (s <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>        fprintf(stderr, <span style=color:#f1fa8c>&#34;getaddrinfo: %s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, gai_strerror(s));
</span></span><span style=display:flex><span>        exit(EXIT_FAILURE);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//socket函数，向系统申请一个通信端口
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sockfd <span style=color:#ff79c6>=</span> socket(result<span style=color:#ff79c6>-&gt;</span>ai_family, result<span style=color:#ff79c6>-&gt;</span>ai_socktype, <span style=color:#bd93f9>0</span>); <span style=color:#6272a4>//IPV4 TCP协议
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (sockfd <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)                         <span style=color:#6272a4>//申请失败
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;call to socket&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4>//pin 定义跟服务端连接的 IP 端口
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> (connect(sockfd, result<span style=color:#ff79c6>-&gt;</span>ai_addr, result<span style=color:#ff79c6>-&gt;</span>ai_addrlen) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error connecting to socket </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>); <span style=color:#6272a4>////
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    freeaddrinfo(result);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> sockfd;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/*argc: 整数,用来统计你运行程序时送给main函数的命令行参数的个数
</span></span></span><span style=display:flex><span><span style=color:#6272a4> * argv: 字符串数组，用来存放指向你的字符串参数的指针数组，每一个元素指向一个参数
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　argv[0] 指向程序运行的全路径名
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　argv[1] 指向在DOS命令行中执行程序名后的第一个字符串
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　argv[2] 指向执行程序名后的第二个字符串
</span></span></span><span style=display:flex><span><span style=color:#6272a4>   */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>**</span>argv)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>8192</span>];
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> message[<span style=color:#bd93f9>256</span>];
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> socket_descriptor;
</span></span><span style=display:flex><span>    <span style=color:#6272a4>/*
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * hostent记录主机的信息，包括主机名、别名、地址类型、地址长度和地址列表
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     * struct hostent {
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　       char *h_name;地址的正式名称
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　       char **h_aliases;空字节-地址的预备名称的指针
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　       int h_addrtype;地址类型; 通常是AF_INET。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　       　int h_length;地址的比特长度。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　       　char **h_addr_list;零字节-主机网络地址指针。网络字节顺序。
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　    };
</span></span></span><span style=display:flex><span><span style=color:#6272a4>　　   #define h_addr h_addr_list[0] //h_addr_list中的第一地址
</span></span></span><span style=display:flex><span><span style=color:#6272a4>     */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>str <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;A default test string&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (argc <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>3</span>) <span style=color:#6272a4>//运行程序时送给main函数到命令行参数个数
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    {
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;Usage:test </span><span style=color:#f1fa8c>\&#34;</span><span style=color:#f1fa8c>Any test string</span><span style=color:#f1fa8c>\&#34;\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;we will send a default test string. </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>else</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        str <span style=color:#ff79c6>=</span> argv[<span style=color:#bd93f9>2</span>];
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    socket_descriptor <span style=color:#ff79c6>=</span> create_sock(argv[<span style=color:#bd93f9>1</span>], <span style=color:#f1fa8c>&#34;8000&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;Sending message %s to server </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, str);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> num1 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span>(num1<span style=color:#ff79c6>++</span> <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span>) {
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;num1:%d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, num1);
</span></span><span style=display:flex><span>        sleep(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (send(socket_descriptor, str, strlen(str), <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error in send</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;..sent message.. wait for response...</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> (recv(socket_descriptor, buf, <span style=color:#bd93f9>8192</span>, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        perror(<span style=color:#f1fa8c>&#34;Error in receiving response from server </span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>        exit(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c> Response from server:</span><span style=color:#f1fa8c>\n\n</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, buf);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    close(socket_descriptor);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> (EXIT_SUCCESS);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></article></div></body><div><small>words: 4102 tags:</small>
<small><code><a href=https://arair.net/tags/linux>linux</a></code></small>
<small><code><a href=https://arair.net/tags/tcp>tcp</a></code></small>
<small><code><a href=https://arair.net/tags/c>c</a></code></small></div></html></body><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?bd28dafb59c7621d0ab721cefd01691b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script>
<script>LA.init({id:"JMTlKgP6j8mqnJSa",ck:"JMTlKgP6j8mqnJSa"})</script></html>