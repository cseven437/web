<!doctype html><html><title>linux进程间通信--信号</title><meta name=description content="概念：
信号是在软件层次上对中断机制的一种模拟，是一种异步通信方式 信号可以直接进行用户空间进程和内核进程之间的交互，内核进程也可以利用它来通知用户空间进程发生了哪些系统事件。 如果该进程当前并未处于执行态，则该信号就由内核保存起来，直到该进程恢复执行再传递给它；如果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被 取消时才被传递给进程。 用户进程对信号的响应方式：
忽略信号：对信号不做任何处理，但是有两个信号不能忽略：即SIGKILL及SIGSTOP。 捕捉信号：定义信号处理函数，当信号发生时，执行相应的处理函数。 执行缺省操作：Linux对每种信号都规定了默认操作 "><meta name=generator content="Hugo 0.101.0"><meta property="og:title" content="linux进程间通信--信号"><meta property="og:description" content="概念：

信号是在软件层次上对中断机制的一种模拟，是一种异步通信方式
信号可以直接进行用户空间进程和内核进程之间的交互，内核进程也可以利用它来通知用户空间进程发生了哪些系统事件。
如果该进程当前并未处于执行态，则该信号就由内核保存起来，直到该进程恢复执行再传递给它；如果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被 取消时才被传递给进程。

用户进程对信号的响应方式：

忽略信号：对信号不做任何处理，但是有两个信号不能忽略：即SIGKILL及SIGSTOP。
捕捉信号：定义信号处理函数，当信号发生时，执行相应的处理函数。
执行缺省操作：Linux对每种信号都规定了默认操作
"><meta property="og:type" content="article"><meta property="og:url" content="https://arair.net/p/language/c/linux/4a8dc548/"><meta property="article:section" content="p"><meta property="article:published_time" content="2021-03-08T10:41:17+08:00"><meta property="article:modified_time" content="2021-03-08T10:41:17+08:00"><meta itemprop=name content="linux进程间通信--信号"><meta itemprop=description content="概念：

信号是在软件层次上对中断机制的一种模拟，是一种异步通信方式
信号可以直接进行用户空间进程和内核进程之间的交互，内核进程也可以利用它来通知用户空间进程发生了哪些系统事件。
如果该进程当前并未处于执行态，则该信号就由内核保存起来，直到该进程恢复执行再传递给它；如果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被 取消时才被传递给进程。

用户进程对信号的响应方式：

忽略信号：对信号不做任何处理，但是有两个信号不能忽略：即SIGKILL及SIGSTOP。
捕捉信号：定义信号处理函数，当信号发生时，执行相应的处理函数。
执行缺省操作：Linux对每种信号都规定了默认操作
"><meta itemprop=datePublished content="2021-03-08T10:41:17+08:00"><meta itemprop=dateModified content="2021-03-08T10:41:17+08:00"><meta itemprop=wordCount content="2436"><meta itemprop=keywords content="linux,c,"><style type=text/css>.markdown-body{box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px;font-family:Consolas,courier new,monospace}@media(max-width:767px){.markdown-body{padding:15px}}</style><script>function setTheme({el:e=document.documentElement,mode:t="auto",light:n="light",dark:s="dark"}){e.dataset.colorMode=t,e.dataset.lightTheme=n,e.dataset.darkTheme=s}let prefersDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches;prefersDarkMode&&setTheme({mode:"dark"})</script><body id=content class=markdown-body><body><div id=post class=post><article><header><h1 class=post-title>linux进程间通信--信号</h1><p><small>2021-03-08</small></p></header><aside><nav id=TableOfContents><ul><li><a href=#signal>signal</a></li><li><a href=#常用信号列表>常用信号列表</a></li><li><a href=#sigemptyset>sigemptyset</a></li><li><a href=#sigaddset>sigaddset</a></li><li><a href=#sigaction>sigaction</a></li><li><a href=#sigqueue>sigqueue</a></li></ul></nav></aside><p>概念：</p><ol><li>信号是在软件层次上对中断机制的一种模拟，是一种异步通信方式</li><li>信号可以直接进行用户空间进程和内核进程之间的交互，内核进程也可以利用它来通知用户空间进程发生了哪些系统事件。</li><li>如果该进程当前并未处于执行态，则该信号就由内核保存起来，直到该进程恢复执行再传递给它；如果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被 取消时才被传递给进程。</li></ol><p>用户进程对信号的响应方式：</p><ol><li>忽略信号：对信号不做任何处理，但是有两个信号不能忽略：即SIGKILL及SIGSTOP。</li><li>捕捉信号：定义信号处理函数，当信号发生时，执行相应的处理函数。</li><li>执行缺省操作：Linux对每种信号都规定了默认操作</li></ol><h2 id=signal>signal</h2><p>设置信号处理方式</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;signal.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#ff79c6>typedef</span> <span style=color:#50fa7b>void</span> (<span style=color:#ff79c6>*</span>sighandler_t)(<span style=color:#8be9fd>int</span>);
</span></span><span style=display:flex><span>sighandler_t <span style=color:#50fa7b>signal</span>(<span style=color:#8be9fd>int</span> signum, sighandler_t handler);
</span></span></code></pre></td></tr></table></div></div><p>参数说明：</p><ul><li><p>signum：信号编号</p></li><li><p>handler：</p></li><li></li><li><p>SIG_IGN：忽略参数signum指定的信号</p></li><li><p>SIG_DFL：将参数signum指定的信号重设为核心预设的信号处理方式，即采用系统默认方式处理信号</p></li><li><p>自定义信号函数处理指针</p></li></ul><p>返回值：</p><ul><li>成功：返回先前的信号处理函数指针</li><li>失败：SIG_ERR(-1)</li></ul><p><strong>示例</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;signal.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/time.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>signalHandler</span>(<span style=color:#8be9fd>int</span> signo)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>switch</span> (signo){
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>case</span> <span style=color:#8be9fd;font-style:italic>SIGALRM</span>:
</span></span><span style=display:flex><span>            printf(<span style=color:#f1fa8c>&#34;Caught the SIGALRM signal!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>int</span> argc, <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>argv[])
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    signal(SIGALRM, signalHandler);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> itimerval new_value, old_value;
</span></span><span style=display:flex><span>    new_value.it_value.tv_sec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    new_value.it_value.tv_usec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>    new_value.it_interval.tv_sec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    new_value.it_interval.tv_usec <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>200000</span>;
</span></span><span style=display:flex><span>    setitimer(ITIMER_REAL, <span style=color:#ff79c6>&amp;</span>new_value, <span style=color:#ff79c6>&amp;</span>old_value);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span>(;;);
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=常用信号列表>常用信号列表</h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>SIGABRT     由调用abort函数产生，进程非正常退出
</span></span><span style=display:flex><span>SIGALRM     用alarm函数设置的timer超时或setitimer函数设置的interval timer超时
</span></span><span style=display:flex><span>SIGBUS      某种特定的硬件异常，通常由内存访问引起
</span></span><span style=display:flex><span>SIGCANCEL   由Solaris Thread Library内部使用，通常不会使用
</span></span><span style=display:flex><span>SIGCHLD     进程Terminate或Stop时候，SIGCHLD会发送给它的父进程。缺省情况下该Signal会被忽略
</span></span><span style=display:flex><span>SIGCONT     当被stop的进程恢复运行的时候，自动发送
</span></span><span style=display:flex><span>SIGEMT      和实现相关的硬件异常
</span></span><span style=display:flex><span>SIGFPE      数学相关的异常，如被0除，浮点溢出，等等
</span></span><span style=display:flex><span>SIGFREEZE   Solaris专用，Hiberate或者Suspended时候发送
</span></span><span style=display:flex><span>SIGHUP      发送给具有Terminal的Controlling Process，当terminal被disconnect时候发送
</span></span><span style=display:flex><span>SIGILL      非法指令异常
</span></span><span style=display:flex><span>SIGINFO     BSD signal。由Status Key产生，通常是CTRL+T。发送给所有Foreground Group的进程
</span></span><span style=display:flex><span>SIGINT      由Interrupt Key产生，通常是CTRL+C或者DELETE。发送给所有ForeGround Group进程
</span></span><span style=display:flex><span>SIGIO       异步IO事件
</span></span><span style=display:flex><span>SIGIOT      实现相关的硬件异常，一般对应SIGABRT
</span></span><span style=display:flex><span>SIGKILL     无法处理和忽略。中止某个进程
</span></span><span style=display:flex><span>SIGLWP      由Solaris Thread Libray内部使用
</span></span><span style=display:flex><span>SIGPIPE     在reader中止之后写Pipe的时候发送
</span></span><span style=display:flex><span>SIGPOLL     当某个事件发送给Pollable Device的时候发送
</span></span><span style=display:flex><span>SIGPROF     Setitimer指定的Profiling Interval Timer所产生
</span></span><span style=display:flex><span>SIGPWR      和系统相关。和UPS相关。
</span></span><span style=display:flex><span>SIGQUIT     输入Quit Key的时候（CTRL+\）发送给所有Foreground Group的进程
</span></span><span style=display:flex><span>SIGSEGV     非法内存访问
</span></span><span style=display:flex><span>SIGSTKFLT   Linux专用，数学协处理器的栈异常
</span></span><span style=display:flex><span>SIGSTOP     中止进程。无法处理和忽略。
</span></span><span style=display:flex><span>SIGSYS      非法系统调用
</span></span><span style=display:flex><span>SIGTERM     请求中止进程，kill命令缺省发送
</span></span><span style=display:flex><span>SIGTHAW     Solaris专用，从Suspend恢复时候发送
</span></span><span style=display:flex><span>SIGTRAP     实现相关的硬件异常。一般是调试异常
</span></span><span style=display:flex><span>SIGTSTP     Suspend Key，一般是Ctrl+Z。发送给所有Foreground Group的进程
</span></span><span style=display:flex><span>SIGTTIN     当Background Group的进程尝试读取Terminal的时候发送
</span></span><span style=display:flex><span>SIGTTOU     当Background Group的进程尝试写Terminal的时候发送
</span></span><span style=display:flex><span>SIGURG      当out-of-band data接收的时候可能发送
</span></span><span style=display:flex><span>SIGUSR1     用户自定义signal 1
</span></span><span style=display:flex><span>SIGUSR2     用户自定义signal 2
</span></span><span style=display:flex><span>SIGVTALRM   setitimer函数设置的Virtual Interval Timer超时的时候
</span></span><span style=display:flex><span>SIGWAITING  Solaris Thread Library内部实现专用
</span></span><span style=display:flex><span>SIGWINCH    当Terminal的窗口大小改变的时候，发送给Foreground Group的所有进程
</span></span><span style=display:flex><span>SIGXCPU     当CPU时间限制超时的时候
</span></span><span style=display:flex><span>SIGXFSZ     进程超过文件大小限制
</span></span><span style=display:flex><span>SIGXRES     Solaris专用，进程超过资源限制的时候发送
</span></span></code></pre></td></tr></table></div></div><h2 id=sigemptyset>sigemptyset</h2><p>将信号集初始化为空。</p><p>glibc中的实现</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#6272a4>/* A `sigset_t&#39; has a bit for each signal.  */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>typedef</span> <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>long</span> <span style=color:#8be9fd>int</span> __sigset_t;         
</span></span><span style=display:flex><span><span style=color:#6272a4>/* A set of signals to be blocked, unblocked, or waited for.  */</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>typedef</span> __sigset_t sigset_t;                                    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>/* Clear all signals from SET.  */</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span>                                  
</span></span><span style=display:flex><span><span style=color:#50fa7b>sigemptyset</span> (sigset_t <span style=color:#ff79c6>*</span>set)          
</span></span><span style=display:flex><span>{                                    
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (set <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span>)                   
</span></span><span style=display:flex><span>    {                                
</span></span><span style=display:flex><span>      __set_errno (EINVAL);          
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>;                     
</span></span><span style=display:flex><span>    }                                
</span></span><span style=display:flex><span>                                     
</span></span><span style=display:flex><span>  memset (set, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>sizeof</span> (sigset_t));
</span></span><span style=display:flex><span>                                     
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;                          
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=sigaddset>sigaddset</h2><p>将指定信号加入到信号集合中去</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;signal.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>sigaddset</span>(sigset_t <span style=color:#ff79c6>*</span>set, <span style=color:#8be9fd>int</span> signum);
</span></span></code></pre></td></tr></table></div></div><h2 id=sigaction>sigaction</h2><p>sigaction函数的功能是检查或修改与指定信号相关联的处理动作</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>sigaction</span>(<span style=color:#8be9fd>int</span> signum, <span style=color:#ff79c6>const</span> <span style=color:#ff79c6>struct</span> sigaction <span style=color:#ff79c6>*</span>act,
</span></span><span style=display:flex><span>                     <span style=color:#ff79c6>struct</span> sigaction <span style=color:#ff79c6>*</span>oldact);
</span></span></code></pre></td></tr></table></div></div><p>参数：</p><ul><li>signum：信号id</li><li>act：对信号的处理</li><li>oldact：保存之前的信号处理信息，可以为NULL</li></ul><p>act与oldact为NULL时，用于检测信号的有效性</p><p>相关结构体</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>struct</span> sigaction {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span>     (<span style=color:#ff79c6>*</span>sa_handler)(<span style=color:#8be9fd>int</span>);
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span>     (<span style=color:#ff79c6>*</span>sa_sigaction)(<span style=color:#8be9fd>int</span>, siginfo_t <span style=color:#ff79c6>*</span>, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>);
</span></span><span style=display:flex><span>    sigset_t   sa_mask;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>        sa_flags;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span>     (<span style=color:#ff79c6>*</span>sa_restorer)(<span style=color:#8be9fd>void</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>siginfo_t {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_signo;    <span style=color:#6272a4>/* Signal number */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_errno;    <span style=color:#6272a4>/* An errno value */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_code;     <span style=color:#6272a4>/* Signal code */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_trapno;   <span style=color:#6272a4>/* Trap number that caused
</span></span></span><span style=display:flex><span><span style=color:#6272a4>                             hardware-generated signal
</span></span></span><span style=display:flex><span><span style=color:#6272a4>                             (unused on most architectures) */</span>
</span></span><span style=display:flex><span>    pid_t    si_pid;      <span style=color:#6272a4>/* Sending process ID */</span>
</span></span><span style=display:flex><span>    uid_t    si_uid;      <span style=color:#6272a4>/* Real user ID of sending process */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_status;   <span style=color:#6272a4>/* Exit value or signal */</span>
</span></span><span style=display:flex><span>    clock_t  si_utime;    <span style=color:#6272a4>/* User time consumed */</span>
</span></span><span style=display:flex><span>    clock_t  si_stime;    <span style=color:#6272a4>/* System time consumed */</span>
</span></span><span style=display:flex><span>    sigval_t si_value;    <span style=color:#6272a4>/* Signal value */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_int;      <span style=color:#6272a4>/* POSIX.1b signal */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span>    <span style=color:#ff79c6>*</span>si_ptr;      <span style=color:#6272a4>/* POSIX.1b signal */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_overrun;  <span style=color:#6272a4>/* Timer overrun count; POSIX.1b timers */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_timerid;  <span style=color:#6272a4>/* Timer ID; POSIX.1b timers */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>void</span>    <span style=color:#ff79c6>*</span>si_addr;     <span style=color:#6272a4>/* Memory location which caused fault */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>long</span>     si_band;     <span style=color:#6272a4>/* Band event (was int in
</span></span></span><span style=display:flex><span><span style=color:#6272a4>                             glibc 2.3.2 and earlier) */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span>      si_fd;       <span style=color:#6272a4>/* File descriptor */</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>short</span>    si_addr_lsb; <span style=color:#6272a4>/* Least significant bit of address
</span></span></span><span style=display:flex><span><span style=color:#6272a4>                             (since Linux 2.6.32) */</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>#ifdef __USE_POSIX199309
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#ff79c6>union</span> sigval
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> sival_int;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>sival_ptr;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>union</span> sigval __sigval_t;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#ff79c6>union</span> __sigval
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> __sival_int;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>__sival_ptr;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>typedef</span> <span style=color:#ff79c6>union</span> __sigval __sigval_t;
</span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span></code></pre></td></tr></table></div></div><p>示例(发送信号函数在<code>sigqueue</code>函数的例子中，需要两个配合测试)：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;signal.h&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>handle_sigaction</span>(<span style=color:#8be9fd>int</span> signum, siginfo_t <span style=color:#ff79c6>*</span>info, <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>context)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;signal:%d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, signum);
</span></span><span style=display:flex><span>    printf(<span style=color:#f1fa8c>&#34;info:%x</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, info<span style=color:#ff79c6>-&gt;</span>si_int);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>struct</span> sigaction act;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    sigemptyset(<span style=color:#ff79c6>&amp;</span>act.sa_mask);
</span></span><span style=display:flex><span>    act.sa_sigaction <span style=color:#ff79c6>=</span> handle_sigaction;
</span></span><span style=display:flex><span>    act.sa_flags <span style=color:#ff79c6>=</span> SA_SIGINFO<span style=color:#ff79c6>|</span>SA_RESTART;
</span></span><span style=display:flex><span>    sigaction(SIGRTMIN<span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span>, <span style=color:#ff79c6>&amp;</span>act, <span style=color:#8be9fd;font-style:italic>NULL</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span>(<span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        sleep(<span style=color:#bd93f9>1</span>);
</span></span><span style=display:flex><span>        printf(<span style=color:#f1fa8c>&#34;sleeping %d</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, i);
</span></span><span style=display:flex><span>        i<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=sigqueue>sigqueue</h2><p>用于给指定进程发送信号，并附带一些参数</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>int</span> sigqueue(pid_t pid, <span style=color:#8be9fd>int</span> sig, <span style=color:#ff79c6>const</span> <span style=color:#ff79c6>union</span> sigval val)
</span></span></code></pre></td></tr></table></div></div><p>参数：</p><ul><li>pid：进程pid</li><li>sig：发送的信号</li><li>val：发送信号时附带的参数</li></ul><p>示例（对应<code>sigaction</code>函数的信号处理示例）：</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;                                                                      </span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;signal.h&gt;                                                                     </span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdlib.h&gt;                                                                     </span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string.h&gt;                                                                     </span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>                                                                                        
</span></span><span style=display:flex><span><span style=color:#ff79c6>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>send_signal</span>(<span style=color:#8be9fd>int</span> flag)                                           
</span></span><span style=display:flex><span>{                                                                                       
</span></span><span style=display:flex><span>    FILE <span style=color:#ff79c6>*</span> fp;                                                                          
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>char</span> buffer[<span style=color:#bd93f9>80</span>];                                                                    
</span></span><span style=display:flex><span>    pid_t pid;                                                                          
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>union</span> sigval sival_data;                                                            
</span></span><span style=display:flex><span>    <span style=color:#8be9fd>int</span> ret;                                                                            
</span></span><span style=display:flex><span>                                                                                        
</span></span><span style=display:flex><span>    fp <span style=color:#ff79c6>=</span> popen(<span style=color:#f1fa8c>&#34;pidof signal_process&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>);                                             
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span>(fp <span style=color:#ff79c6>!=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>){                                                                     
</span></span><span style=display:flex><span>        memset(buffer,<span style=color:#bd93f9>0x00</span>,<span style=color:#ff79c6>sizeof</span>(buffer));                                             
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> ((fgets(buffer,<span style=color:#ff79c6>sizeof</span>(buffer),fp) <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span>) <span style=color:#ff79c6>||</span> (buffer[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;\0&#39;</span>)){          
</span></span><span style=display:flex><span>            pclose(fp);                                                                 
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span>;                                                                     
</span></span><span style=display:flex><span>        }                                                                               
</span></span><span style=display:flex><span>    }<span style=color:#ff79c6>else</span>{                                                                              
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span>;                                                                         
</span></span><span style=display:flex><span>    }                                                                                   
</span></span><span style=display:flex><span>    pclose(fp);                                                                         
</span></span><span style=display:flex><span>                                                                                        
</span></span><span style=display:flex><span>    pid <span style=color:#ff79c6>=</span> atoi(buffer);                                                                 
</span></span><span style=display:flex><span>    sival_data.sival_int <span style=color:#ff79c6>=</span> flag;                                                        
</span></span><span style=display:flex><span>    ret <span style=color:#ff79c6>=</span> sigqueue(pid, SIGRTMIN<span style=color:#ff79c6>+</span><span style=color:#bd93f9>9</span>, sival_data);                                        
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span>;                                                                             
</span></span><span style=display:flex><span>}                                                                                       
</span></span><span style=display:flex><span>                                                                                        
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>()                                                                              
</span></span><span style=display:flex><span>{                                                                                       
</span></span><span style=display:flex><span>    send_signal(<span style=color:#bd93f9>8</span>);                                                         
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;                                                                           
</span></span><span style=display:flex><span>}                                                                                       
</span></span><span style=display:flex><span>                                                                                        
</span></span></code></pre></td></tr></table></div></div></article></div></body><div><small>words: 2436 tags:</small>
<small><code><a href=https://arair.net/tags/linux>linux</a></code></small>
<small><code><a href=https://arair.net/tags/c>c</a></code></small></div></html></body><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?bd28dafb59c7621d0ab721cefd01691b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script id=LA_COLLECT src=//sdk.51.la/js-sdk-pro.min.js></script>
<script>LA.init({id:"JMTlKgP6j8mqnJSa",ck:"JMTlKgP6j8mqnJSa"})</script></html>